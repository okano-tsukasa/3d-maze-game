================================================================================
                             設計書
                        3D迷路ゲーム
================================================================================

作成日: 2025年11月20日
バージョン: 1.0

================================================================================
1. システム構成
================================================================================

1.1 アーキテクチャ概要

    単一ファイル構成のシンプルなゲームアプリケーション

    [ユーザー入力]
         ↓
    [メインループ] ← [raylib API]
         ↓
    [ゲームロジック]
         ↓
    [描画処理]
         ↓
    [画面表示]

1.2 ファイル構成

    3d-maze-game/
    ├── docs/
    │   ├── 要件定義書.txt
    │   ├── 設計書.txt（本書）
    │   ├── 動作テスト手順書.txt
    │   └── テスト結果レポート.txt
    ├── src/
    │   └── main.c
    ├── tests/
    ├── .gitignore
    ├── Makefile
    ├── LICENSE
    └── README.md

================================================================================
2. データ構造設計
================================================================================

2.1 迷路データ

    データ型: int型の2次元配列
    サイズ: 10x10
    値の意味:
        0 = 通路（移動可能）
        1 = 壁（移動不可）

    例:
    int maze[10][10] = {
        {1,1,1,1,1,1,1,1,1,1},
        {1,0,0,0,1,0,0,0,0,1},
        ...
    };

2.2 プレイヤー位置

    データ型: Vector3構造体（raylibが提供）
    メンバ:
        float x: X座標
        float y: Y座標（高さ）
        float z: Z座標

    カメラとして管理:
    Camera3D camera;
    camera.position: プレイヤーの現在位置
    camera.target: プレイヤーの視点方向

2.3 ゴール位置

    データ型: Vector3構造体
    固定値: (17.0f, 0.5f, 17.0f)
    ※ 迷路座標(8,8)を3D座標に変換

2.4 ゲーム状態

    データ型: bool型
    変数名: gameCleared
    意味:
        false: ゲーム進行中
        true: ゴール到達（クリア）

================================================================================
3. 関数設計
================================================================================

3.1 main関数

    役割: プログラムのエントリーポイント、メインループの実行

    処理フロー:
    1. ウィンドウ初期化
    2. カメラ初期化
    3. 迷路データ初期化
    4. メインループ
       4.1 入力処理
       4.2 ゲームロジック更新
       4.3 描画処理
    5. 終了処理

    擬似コード:
    ```
    int main(void) {
        // 1. 初期化
        InitWindow(800, 600, "3D Maze Game");
        SetTargetFPS(60);

        // 2. カメラ設定
        Camera3D camera = { ... };

        // 3. 迷路データ
        int maze[10][10] = { ... };

        bool gameCleared = false;

        // 4. メインループ
        while (!WindowShouldClose()) {
            // 4.1 入力処理
            if (!gameCleared) {
                UpdateCamera(&camera, CAMERA_FIRST_PERSON);
            }

            // 4.2 ゲームロジック
            CheckGoalReached(&gameCleared, camera.position);

            // 4.3 描画
            BeginDrawing();
                Draw3DMaze(maze);
                DrawUI(gameCleared);
            EndDrawing();
        }

        // 5. 終了
        CloseWindow();
        return 0;
    }
    ```

3.2 迷路描画関数（インライン実装）

    役割: 3D迷路の壁と床を描画

    処理内容:
    - 2次元配列をループで走査
    - 値が1の場合、壁（立方体）を描画
    - すべての床を描画
    - ゴール地点を緑色の立方体で描画

3.3 ゴール判定関数（インライン実装）

    役割: プレイヤーがゴールに到達したか判定

    処理内容:
    - プレイヤー位置とゴール位置の距離を計算
    - 距離が一定値以下ならゴール到達とする

================================================================================
4. 画面設計
================================================================================

4.1 ウィンドウ仕様

    サイズ: 800 x 600 ピクセル
    タイトル: "3D Maze Game"
    背景色: RAYWHITE

4.2 3D空間設定

    カメラタイプ: CAMERA_FIRST_PERSON（一人称視点）
    視野角(FOV): 60度
    カメラ位置: (3.0, 1.5, 3.0) ※スタート地点
    カメラターゲット: (4.0, 1.5, 3.0) ※初期視線方向
    上方向ベクトル: (0.0, 1.0, 0.0)

4.3 色設定

    壁: GRAY (グレー)
    床: DARKGRAY (ダークグレー)
    ゴール: GREEN (緑)
    テキスト:
        通常時: DARKGRAY
        クリア時: GREEN

4.4 UI要素配置

    操作説明:
        位置: 左上 (10, 10)
        内容: "WASD: Move | Mouse: Look | ESC: Exit"

    FPS表示:
        位置: 右上 (画面幅 - 100, 10)

    クリアメッセージ:
        位置: 中央上部 (画面幅/2 - 150, 50)
        内容: "GOAL! Press ESC to exit"

================================================================================
5. ゲームロジック設計
================================================================================

5.1 移動制御

    入力方式: raylibのCameraModeを使用
    モード: CAMERA_FIRST_PERSON

    キー割り当て:
        W: 前進
        S: 後退
        A: 左移動
        D: 右移動
        マウス: 視点回転

    制約:
        - ゴール到達後は移動不可
        - カメラ更新を停止

5.2 衝突判定

    方式: raylibの標準カメラ制御を使用
    ※ 今回は簡易実装のため、詳細な衝突判定は実装しない
    （壁を視覚的に配置し、プレイヤーが通り抜けないよう配置）

5.3 ゴール判定

    判定方法: 距離ベース

    計算式:
        distance = sqrt(
            (player.x - goal.x)^2 +
            (player.z - goal.z)^2
        )

    判定条件:
        if (distance < 1.5) -> ゴール到達

5.4 ゲーム状態遷移

    初期状態 → ゲーム進行中
        ↓
        ゴール到達判定
        ↓
    ゲームクリア → 移動停止

================================================================================
6. 迷路レイアウト設計
================================================================================

6.1 迷路マップ（10x10グリッド）

    凡例: 1=壁, 0=通路, S=スタート, G=ゴール

    {1,1,1,1,1,1,1,1,1,1},
    {1,S,0,0,1,0,0,0,0,1},
    {1,0,1,0,1,0,1,1,0,1},
    {1,0,1,0,0,0,0,1,0,1},
    {1,0,1,1,1,1,0,1,0,1},
    {1,0,0,0,0,0,0,1,0,1},
    {1,1,1,1,1,1,0,1,0,1},
    {1,0,0,0,0,0,0,1,0,1},
    {1,0,1,1,1,1,1,1,G,1},
    {1,1,1,1,1,1,1,1,1,1}

    スタート座標: (1, 1) -> 3D座標 (3.0, 1.5, 3.0)
    ゴール座標: (8, 8) -> 3D座標 (17.0, 0.5, 17.0)

6.2 座標変換

    迷路座標(mx, my) → 3D座標(x, y, z)

    変換式:
        x = mx * 2.0
        y = 0.5 (壁の高さの半分)
        z = my * 2.0

    壁のサイズ: 2.0 x 3.0 x 2.0 (幅x高さx奥行き)

================================================================================
7. ビルド設定
================================================================================

7.1 コンパイルオプション

    コンパイラ: gcc
    標準: C99 (-std=c99)
    最適化: -O2
    警告: -Wall

    インクルードパス:
        -I/c/msys64/ucrt64/include

    ライブラリパス:
        -L/c/msys64/ucrt64/lib

    リンクライブラリ:
        -lraylib -lopengl32 -lgdi32 -lwinmm

7.2 Makefile構成

    ターゲット:
        all: ビルド
        clean: クリーンアップ
        run: 実行

    成果物:
        maze_game.exe

================================================================================
8. エラーハンドリング
================================================================================

8.1 想定されるエラー

    - ウィンドウ初期化失敗
    - raylibライブラリの読み込み失敗

8.2 対処方針

    - raylibの初期化は自動で行われる
    - エラー発生時は適切なメッセージを表示
    - 致命的なエラーは発生しない設計

================================================================================
9. パフォーマンス設計
================================================================================

9.1 目標FPS

    60 FPS (SetTargetFPS(60))

9.2 最適化方針

    - 静的な迷路データ（実行時に変更なし）
    - 描画呼び出しの最小化
    - シンプルなジオメトリ（立方体のみ）

9.3 リソース使用量

    メモリ: 約10MB以下
    CPU: シングルコア、低負荷
    GPU: OpenGL 3.3対応で十分

================================================================================
10. セキュリティ設計
================================================================================

10.1 セキュリティ方針

    - ネットワーク通信なし
    - ファイル入出力なし
    - ユーザーデータ収集なし
    - 悪意のあるコードなし

10.2 安全性

    - バッファオーバーフローのリスクなし
    - 外部入力は標準的なキーボード・マウス入力のみ
    - raylibの安全なAPI使用

================================================================================
11. 拡張性設計
================================================================================

11.1 将来の拡張可能性

    - 迷路データの外部ファイル化
    - 複数レベルの追加
    - タイマー・スコア機能
    - サウンド追加
    - より複雑な衝突判定

11.2 モジュール化の可能性

    現在: 単一ファイル構成
    将来: 以下のモジュール分割が可能
        - maze.c/h (迷路データと描画)
        - player.c/h (プレイヤー制御)
        - game.c/h (ゲームロジック)
        - main.c (エントリーポイント)

================================================================================
12. テスト設計方針
================================================================================

12.1 テスト項目

    - 起動・終了テスト
    - 移動操作テスト
    - 視点操作テスト
    - ゴール判定テスト
    - UI表示テスト
    - パフォーマンステスト

12.2 テスト環境

    - Windows 10/11
    - MSYS2環境

================================================================================
13. Git管理設計
================================================================================

13.1 バージョン管理方針

    - Gitによるバージョン管理
    - GitHubでの公開
    - MITライセンスの適用

13.2 .gitignoreの設定

    除外対象:
        - ビルド成果物 (*.exe, *.o)
        - エディタ一時ファイル
        - OS固有ファイル

13.3 コミット方針

    - 機能単位でのコミット
    - わかりやすいコミットメッセージ
    - 日本語または英語

13.4 ブランチ戦略

    初期段階:
        - main ブランチのみ

    将来的:
        - feature ブランチでの機能開発
        - main ブランチへのマージ

================================================================================
14. 承認
================================================================================

本設計書に基づいて実装を行います。

作成者: Claude Code
承認者: ユーザー

================================================================================
